apiVersion: directory.forgerock.io/v1alpha1
kind: DirectoryService
metadata:
  name: ds
spec:
  image: gcr.io/forgeops-public/ds-idrepo:latest
  # The number of DS servers in the topology
  replicas: 1
  # The resources assigned to each DS pod
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1024Mi
  # Passwords map DS accounts to new or existing secrets.
  # For example, a secret may have been generated by another operator such as secret agent.
  # Referenced secrets are not deleted when the CR is deleted.
  passwords:
    # uid=admin and uid=monitor are required account secrets.
    uid=admin:
      secretName: ds-passwords
      key: dirmanager.pw
    # In this example we want to generate a random secret for the monitor.
    # If a secret is generated, the secret Name will be prefixed by "${metadata.name}-"
    # Generated secrets are deleted if the CR is deleted.
    uid=monitor:
      secretName: monitor
      key: password
      create: true
    # An example of a service account password. The operator will generate a password (create=true)
    # Create the secret (ds-am-cts-account)
    # And will set the password value in ldap
    "uid=openam_cts,ou=admins,ou=famrecords,ou=openam-session,ou=tokens":
      secretName: am-cts-account
      key: password
      create: true
  keystores:
    # The name of the secret that contains the DS keystore
    # The secret must contain at least two keys: keystore and keystore.pin
    # keystore is a pkcs12 Java keystore.
    # Currently the operator can not generate this. Use Secret Agent.
    keyStoreSecretName: ds
    # Truststore - Do we need it?
    # trustStoreSecretName: foo
  backup:
    enabled: true
    # starts with s3://, gs:// , az:// or a path to the filesystem
    # The system will calculate a unique name for the backup that includes then name, namespace
    path: /var/run/backup
    cron: "0 * * * *"
    secretName: cloud-storage-credentials
  # Restore from the backup if the data directory is empty
  restore:
    enabled: true
    # TODO: Do we infer the backup to restore using the namespace and name
    path: /var/run/backup
    secretName: cloud-storage-credentials





