# Sample DirectoryService deployment
apiVersion: directory.forgerock.io/v1alpha1
kind: DirectoryService
metadata:
  name: ds
spec:
  image:  gcr.io/engineering-devops/ds-idrepo:7028cd85
  # The number of DS servers in the topology
  replicas: 1
  # The resources assigned to each DS pod
  resources:
    requests:
      memory: 900Mi
      cpu: 250m
    limits:
      memory: 1024Mi
  storage: 5Gi
  # StorageClassName for the PVC. This should be very fast SSD disk for the directory server data
  storageClassName: fast
  # Passwords: maps DS accounts to new or existing secrets.
  # The operator supports "bring your own secrets". For example, a secret may have been generated by another operator such as secret agent.
  # A secret that does not set create: true is assumed to be supplied externally. External secrets will not be deleted by the operator
  passwords:
    # uid=admin and uid=monitor are required account secrets.
    uid=admin:
      secretName: ds-passwords
      key: dirmanager.pw
    uid=monitor:
      secretName: ds-passwords
      key: monitor.pw
    # An example of a service account password. The operator will generate a password (create=true)
    # Create the secret containing the password (am-cts-account)
    # And will set the password value in the ldap server
    "uid=openam_cts,ou=admins,ou=famrecords,ou=openam-session,ou=tokens":
      secretName: am-cts-account
      key: password
      create: true
  keystores:
    # The name of the secret that contains the DS keystore
    # The secret must contain at least two keys: keystore and keystore.pin
    # keystore is a pkcs12 Java keystore.
    # Currently the operator can not generate this. Use Secret Agent.
    keyStoreSecretName: ds
    # Truststore - Do we need it?
    # trustStoreSecretName: foo

  #### Backup and Restore ####
  backup:
    enabled: false
    # Path starts with s3://, gs:// , az:// or a path to the filesystem
    #path: /var/tmp/backup
    path: gs://ds-operator-engineering-devops/ds-backup-test
    # Crontab(5) format for the schedule
    # Examples:
    # "*/5 * * * *""  - every 5 minutes (good for testing)
    # "35 * * * *" backup at 35 minutes past the hour, every hour
    cron: "35 * * * *"
    # The secret below must have one of the following keys:
    # AZURE_ACCOUNT_KEY:       # Update if using Azure cloud storage for DS Backups
    # AZURE_ACCOUNT_NAME:      # Update if using Azure cloud storage for DS Backups
    # AWS_ACCESS_KEY_ID:       # Update if using AWS cloud storage for DS Backups
    # AWS_SECRET_ACCESS_KEY:   # Update if using AWS cloud storage for DS Backups
    # GOOGLE_CREDENTIALS: # Update if using GCP cloud storage for DS Backups
    secretName: cloud-storage-credentials
    # purgeHours - backups older than this many hours will be purged. Defaults to 100 days (2400)
    purgeHours: 100
    # purgeCron - how often to run the purge task to purge old backups. Defaults to "40 0 * * *"
    purgeCron: "40 0 * * *"
  # Restore from the last backup if the data directory is empty
  restore:
    enabled: false
    path: gs://ds-operator-engineering-devops/ds-backup-test
    secretName: cloud-storage-credentials





